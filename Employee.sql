CREATE DATABASE IF NOT EXISTS Company;

USE Company;


-- SHOW DATABASES;
-- SHOW TABLES;


CREATE TABLE DEPT (
    DEPTNO INT PRIMARY KEY,
    DNAME VARCHAR(50),
    DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
    EMPNO INT PRIMARY KEY,
    ENAME VARCHAR(50),
    MGR_NO INT,
    HIREDATE DATE,
    SAL DECIMAL(10,2),
    DEPTNO INT,
    FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
    ON DELETE CASCADE 
    ON UPDATE CASCADE
);

CREATE TABLE PROJECT (
    PNO INT PRIMARY KEY,
    PNAME VARCHAR(50),
    PLOC VARCHAR(50)
);

CREATE TABLE ASSIGNED_TO (
    EMPNO INT,
    PNO INT,
    JOB_ROLE VARCHAR(50),
    PRIMARY KEY (EMPNO, PNO),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
    FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
    ON DELETE CASCADE 
    ON UPDATE CASCADE
);

CREATE TABLE INCENTIVES (
    EMPNO INT,
    INCENTIVE_DATE DATE,
    INCENTIVE_AMOUNT DECIMAL(10,2),
    PRIMARY KEY (EMPNO, INCENTIVE_DATE),
    FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
    ON DELETE CASCADE 
    ON UPDATE CASCADE
);




INSERT INTO DEPT (DEPTNO, DNAME, DLOC)
VALUES 
(1, 'HR', 'New York'),
(2, 'Finance', 'London'),
(3, 'IT', 'Bangalore'),
(4, 'Marketing', 'Chicago'),
(5, 'Operations', 'Sydney'),
(6, 'R&D', 'Tokyo');

INSERT INTO EMPLOYEE (EMPNO, ENAME, MGR_NO, HIREDATE, SAL, DEPTNO)
VALUES 
(101, 'Alice', NULL, '2022-01-10', 75000.00, 1),
(102, 'Bob', 101, '2021-07-15', 80000.00, 2),
(103, 'Charlie', 102, '2020-12-01', 90000.00, 3),
(104, 'David', 103, '2023-03-20', 65000.00, 4),
(105, 'Eve', 101, '2021-11-30', 70000.00, 5),
(106, 'Frank', 104, '2023-06-18', 60000.00, 6);


INSERT INTO PROJECT (PNO, PNAME, PLOC)
VALUES 
(201, 'AI System', 'New York'),
(202, 'Accounting Tool', 'London'),
(203, 'Network Upgrade', 'Bangalore'),
(204, 'Ad Campaign', 'Chicago'),
(205, 'Process Optimization', 'Sydney'),
(206, 'Product Innovation', 'Tokyo');



INSERT INTO ASSIGNED_TO (EMPNO, PNO, JOB_ROLE)
VALUES 
(101, 201, 'Team Lead'),
(102, 202, 'Analyst'),
(103, 203, 'Engineer'),
(104, 204, 'Manager'),
(105, 205, 'Specialist'),
(106, 206, 'Developer');


INSERT INTO INCENTIVES (EMPNO, INCENTIVE_DATE, INCENTIVE_AMOUNT)
VALUES 
(101, '2023-01-15', 1500.00),
(102, '2023-02-20', 2000.00),
(103, '2023-03-10', 1800.00),
(104, '2023-04-25', 2500.00),
(105, '2023-05-05', 1700.00),
(106, '2023-06-30', 1900.00);




-- 3.)

SELECT EMPNO
FROM ASSIGNED_TO
WHERE PNO IN (
	SELECT PNO FROM PROJECT WHERE PLOC IN ('Bangalore','Sydney','London')
);



-- 4.)

SELECT EMPNO,ENAME
FROM EMPLOYEE
WHERE EMPNO NOT IN(
	SELECT EMPNO FROM INCENTIVES
);

-- 5.)

SELECT e.ENAME,e.EMPNO,d.DNAME,a.JOB_ROLE,d.DLOC,p.PLOC
FROM EMPLOYEE e, PROJECT p, ASSIGNED_TO a, DEPT d
WHERE p.PLOC = d.DLOC
AND p.PNO=a.PNO
AND a.EMPNO = e.EMPNO
AND e.DEPTNO=d.DEPTNO;



SELECT e.ENAME AS EmployeeName,e.EMPNO AS EmployeeNumber,m.ENAME AS ManagerName,m.EMPNO AS MangerNumber
FROM EMPLOYEE e, EMPLOYEE m
WHERE e.MGR_NO = m.EMPNO
GROUP BY m.ENAME;




-- Extra queries

-- 3.)
-- Getting EMployee and corresponding managers names
SELECT e.ENAME AS EMPLOYEE,m.ENAME AS MANAGER
FROM EMPLOYEE e, EMPLOYEE m
WHERE e.MGR_NO=m.EMPNO;



SELECT m.ENAME AS MANAGER, COUNT(m.ENAME) AS count
FROM EMPLOYEE e, EMPLOYEE m
WHERE e.MGR_NO=m.EMPNO
GROUP BY m.ENAME
ORDER BY count DESC
LIMIT 1;


-- 4.)

-- Intuition
SELECT e.ENAME AS EMPLOYEE,e.SAL AS EMP_SAL,m.ENAME AS MANAGER,m.SAL AS MGR_SAL	
FROM EMPLOYEE e, EMPLOYEE m
WHERE e.MGR_NO=m.EMPNO
GROUP BY MANAGER
HAVING MGR_SAL > AVG(EMP_SAL);


SELECT m.ENAME AS MANAGER	
FROM EMPLOYEE e, EMPLOYEE m
WHERE e.MGR_NO=m.EMPNO
GROUP BY m.ENAME
HAVING m.SAL > AVG(e.SAL);

-- 7.)
SELECT e.ENAME  AS EMPLOYEE, m.ENAME AS MANAGER
FROM EMPLOYEE e JOIN EMPLOYEE m
ON e.MGR_NO=m.EMPNO;


SELECT * FROM DEPT;
SELECT * FROM EMPLOYEE;
SELECT * FROM PROJECT;
SELECT * FROM ASSIGNED_TO;
SELECT * FROM INCENTIVES;
